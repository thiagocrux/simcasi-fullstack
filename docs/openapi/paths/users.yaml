collection:
  get:
    operationId: findUsers
    summary: Find users
    description: Retrieves a paginated list of users with optional filtering by name or email, including soft-deleted accounts if requested.
    tags:
      - Users
    security:
      - BearerAuth: []
    parameters:
      - $ref: '../components/parameters.yaml#/Page'
      - $ref: '../components/parameters.yaml#/Limit'
      - $ref: '../components/parameters.yaml#/Search'
      - $ref: '../components/parameters.yaml#/IncludeDeleted'
    responses:
      '200':
        description: Paginated list of users successfully retrieved (OK).
        content:
          application/json:
            schema:
              $ref: '../components/schemas/user.yaml#/UserListResponse'
      '401':
        $ref: '../components/responses.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses.yaml#/ForbiddenError'
  post:
    operationId: createUser
    summary: Register a user
    description: Persists a new user record with credentials and links it to a specific RBAC role.
    tags:
      - Users
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/user.yaml#/UserCreateRequest'
          examples:
            newUser:
              summary: Create new user with role
              value:
                name: Dr. Maria Santos
                email: dr.santos@simcasi.gov.br
                password: SecurePassword#2026
                roleId: a1b2c3d4-5678-90ab-cdef-1234567890ab
                ipAddress: 192.168.1.105
                userAgent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)
    responses:
      '201':
        description: User successfully created and persisted (Created).
        content:
          application/json:
            schema:
              $ref: '../components/schemas/user.yaml#/User'
      '401':
        $ref: '../components/responses.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses.yaml#/ForbiddenError'
      '404':
        $ref: '../components/responses.yaml#/NotFoundError'
      '409':
        $ref: '../components/responses.yaml#/ConflictError'
      '422':
        $ref: '../components/responses.yaml#/ValidationError'

item:
  get:
    operationId: getUser
    summary: Get a user
    description: Fetches complete profile data and metadata for a single user record identified by its UUID.
    tags:
      - Users
    security:
      - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        description: Unique identifier for the user.
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: User details successfully retrieved (OK).
        content:
          application/json:
            schema:
              $ref: '../components/schemas/user.yaml#/User'
      '401':
        $ref: '../components/responses.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses.yaml#/ForbiddenError'
      '404':
        $ref: '../components/responses.yaml#/NotFoundError'
  patch:
    operationId: updateUser
    summary: Update a user
    description: Updates profile information for an existing user record. Only provided fields are updated.
    tags:
      - Users
    security:
      - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        description: Unique identifier for the user.
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/user.yaml#/UserUpdateRequest'
          examples:
            updateUserEmail:
              summary: Update user email and role
              value:
                email: joao.santos.novo@hospital.com.br
                roleId: role-supervisor-789
                ipAddress: 192.168.1.105
                userAgent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36
    responses:
      '200':
        description: User successfully updated with provided changes (OK).
        content:
          application/json:
            schema:
              $ref: '../components/schemas/user.yaml#/User'
      '401':
        $ref: '../components/responses.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses.yaml#/ForbiddenError'
      '404':
        $ref: '../components/responses.yaml#/NotFoundError'
      '409':
        $ref: '../components/responses.yaml#/ConflictError'
      '422':
        $ref: '../components/responses.yaml#/ValidationError'
  delete:
    operationId: deleteUser
    summary: Delete a user
    description: Flag a user record as deleted (soft-delete), removing access without erasing historical data.
    tags:
      - Users
    security:
      - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        description: Unique identifier for the user.
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/commons.yaml#/AuditMetadata'
          examples:
            deleteUser:
              summary: Soft-delete user with audit trail
              value:
                ipAddress: 192.168.1.105
                userAgent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36
    responses:
      '204':
        description: User successfully soft-deleted from active records (No Content).
      '401':
        $ref: '../components/responses.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses.yaml#/ForbiddenError'
      '404':
        $ref: '../components/responses.yaml#/NotFoundError'

restore:
  post:
    operationId: restoreUser
    summary: Restore a user
    description: Reverses a soft-delete operation, restoring the user's active status and system access.
    tags:
      - Users
    security:
      - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        description: Unique identifier for the user.
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/commons.yaml#/AuditMetadata'
          examples:
            restoreUser:
              summary: Restore deleted user with audit trail
              value:
                ipAddress: 192.168.1.105
                userAgent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36
    responses:
      '200':
        description: User successfully restored to active status (OK).
        content:
          application/json:
            schema:
              $ref: '../components/schemas/user.yaml#/User'
      '401':
        $ref: '../components/responses.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses.yaml#/ForbiddenError'
      '404':
        $ref: '../components/responses.yaml#/NotFoundError'
